// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Review {
  review_id   Int      @id @default(autoincrement())
  product_id  Int
  product     Product  @relation(fields: [product_id], references: [product_id])
  customer_id Int
  customer    Customer @relation(fields: [customer_id], references: [customer_id])
  rating      Int
  created_at  DateTime @default(now())
}

model Customer {
  customer_id          Int               @id @default(autoincrement())
  first_name           String
  last_name            String
  email                String            @unique
  password_hash        String?
  oauth_provider       String?
  oauth_id             String?
  phone                String?
  country              String?
  default_address_id   Int?              @unique
  default_address      Adresse?          @relation("DefaultAddress", fields: [default_address_id], references: [address_id])
  addresses            Adresse[]         @relation("CustomerAddresses")
  accounts             CustomerAccount[]
  is_active            Boolean           @default(true)
  reviews              Review[]
  created_at           DateTime          @default(now())
  updated_at           DateTime          @updatedAt
  deleted_at           DateTime?
  delete_scheduled_for DateTime?
  Commande             Commande[]
  supportTickets       SupportTicket[]
  supportMessages      SupportMessage[]
}

model CustomerAccount {
  customer_account_id Int      @id @default(autoincrement())
  customer_id         Int
  customer            Customer @relation(fields: [customer_id], references: [customer_id])
  type                String
  adresseEntreprise   String?
  emailEntreprise     String?
  entrepriseName      String?
  phoneEntreprise     String?
  countryEntreprise   String?

  activate_pro DateTime?
  disabled_pro DateTime?
}

model Adresse {
  address_id  Int        @id @default(autoincrement())
  customer_id Int
  customer    Customer   @relation("CustomerAddresses", fields: [customer_id], references: [customer_id])
  line1       String
  line2       String?
  city        String
  postal_code String?
  country     String
  created_at  DateTime   @default(now())
  updated_at  DateTime   @updatedAt
  default_for Customer?  @relation("DefaultAddress")
  Commande    Commande[]
}

model Role {
  role_id Int    @id @default(autoincrement())
  name    String
  users   User[]
}

model User {
  user_id                Int              @id @default(autoincrement())
  username               String?
  email                  String           @unique
  phone                  String?
  password_hash          String
  role_id                Int
  role                   Role             @relation(fields: [role_id], references: [role_id])
  last_login             DateTime?
  created_at             DateTime         @default(now())
  updated_at             DateTime         @updatedAt
  Commande               Commande[]
  blogs                  Blog[]
  supportTicketsAssigned SupportTicket[]  @relation("TicketAdmin")
  supportMessages        SupportMessage[] @relation("MessageAdmin")
}

model Service {
  service_id       Int         @id @default(autoincrement())
  name             String
  image_url        String?
  description      String?     @db.Text
  slug             String?
  meta_title       String?
  meta_description String?     @db.Text
  meta_keywords    String?
  meta_image_url   String?
  schema_markup    Json?
  secure           Boolean?    @default(false)
  is_active        Boolean     @default(true)
  created_at       DateTime    @default(now())
  updated_at       DateTime    @updatedAt
  categories       Categorie[]
  Product          Product[]

  @@index([slug])
}

model Blog {
  blog_id          Int       @id @default(autoincrement())
  title            String
  slug             String    @unique
  content          String    @db.Text
  excerpt          String?   @db.Text
  image_url        String?
  meta_title       String?
  meta_description String?   @db.Text
  meta_keywords    String?
  meta_image_url   String?
  schema_markup    Json?
  author_id        Int
  author           User      @relation(fields: [author_id], references: [user_id])
  is_active        Boolean   @default(true)
  published_at     DateTime?
  created_at       DateTime  @default(now())
  updated_at       DateTime  @updatedAt

  @@index([slug])
  @@index([published_at])
}

model Categorie {
  categorie_id     Int       @id @default(autoincrement())
  name             String
  description      String?   @db.Text
  slug             String?
  meta_title       String?
  meta_description String?   @db.Text
  meta_keywords    String?
  meta_image_url   String?
  schema_markup    Json?
  secure           Boolean?  @default(false)
  is_active        Boolean   @default(true)
  service_id       Int
  service          Service   @relation(fields: [service_id], references: [service_id])
  created_at       DateTime  @default(now())
  updated_at       DateTime  @updatedAt
  Product          Product[]

  @@index([slug])
}

model Product {
  product_id            Int              @id @default(autoincrement())
  name                  String
  description           String?          @db.Text
  descriptionRich       String?          @db.Text
  currency              String
  currency_name         String
  price                 Decimal
  price_pro             Decimal          @default(0.00)
  min_co_standard       Int?
  min_co_pro            Int?
  stock_quantity        Int
  image_url             String?
  secure                Boolean?         @default(false)
  is_for_pro            Boolean?         @default(false)
  suggest               Boolean          @default(false)
  min_commande_standard Json?            @default("{\"tiers\":[]}")
  min_commande_prof     Json?            @default("{\"tiers\":[]}")
  service_id            Int
  service               Service          @relation(fields: [service_id], references: [service_id])
  category_id           Int
  category              Categorie        @relation(fields: [category_id], references: [categorie_id])
  is_active             Boolean          @default(true)
  created_at            DateTime         @default(now())
  updated_at            DateTime         @updatedAt
  productImages         ProductImage[]
  reviews               Review[]
  CommandeDetail        CommandeDetail[]
}

model ProductImage {
  product_image_id Int      @id @default(autoincrement())
  product_id       Int
  product          Product  @relation(fields: [product_id], references: [product_id])
  image_url        String
  created_at       DateTime @default(now())
}

model ContactInfo {
  contact_info_id Int      @id @default(autoincrement())
  name            String
  email           String
  phone           String?
  subject         String   @db.Text
  message         String?  @db.Text
  seen            Boolean? @default(false)
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
}

model NewsLetter {
  newsletter_id Int      @id @default(autoincrement())
  email         String   @unique
  created_at    DateTime @default(now())
}

model RecruitmentApplication {
  recruitment_id   Int      @id @default(autoincrement())
  offer_type       String
  offer_title      String?
  full_name        String
  email            String
  phone            String?
  company          String?
  speciality       String?
  experience_years Int?
  availability     String?
  work_mode        String?
  country          String?
  city             String?
  budget_range     String?
  skills           String?  @db.Text
  message          String?  @db.Text
  linkedin_url     String?
  website_url      String?
  status           String   @default("pending")
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt

  @@index([offer_type])
  @@index([status])
}

model CommandeDetail {
  detail_id   Int      @id @default(autoincrement())
  commande_id Int
  commande    Commande @relation(fields: [commande_id], references: [commande_id])
  product_id  Int
  product     Product  @relation(fields: [product_id], references: [product_id])
  quantity    Int
  unit_price  Decimal
  created_at  DateTime @default(now())
}

model Commande {
  commande_id               Int              @id @default(autoincrement())
  customer_id               Int
  customer                  Customer         @relation(fields: [customer_id], references: [customer_id])
  order_date                DateTime
  delivery_date             DateTime?
  status                    String
  total_amount              Decimal
  payment_method            String?
  type                      String           @default("standard")
  shipping_address          String?
  shipping_address_id       Int?
  shipping_address_relation Adresse?         @relation(fields: [shipping_address_id], references: [address_id])
  created_at                DateTime         @default(now())
  updated_at                DateTime         @updatedAt
  admin_id                  Int?
  admin                     User?            @relation(fields: [admin_id], references: [user_id])
  details                   CommandeDetail[]
  payments                  Payment[]
}

model Payment {
  payment_id       Int      @id @default(autoincrement())
  commande_id      Int
  commande         Commande @relation(fields: [commande_id], references: [commande_id])
  amount           Decimal
  payment_method   String
  status           String
  transaction_id   String?
  transaction_date DateTime
}

model Packaging {
  id          Int      @id @default(autoincrement())
  user_id     Int?
  email       String?
  state       Boolean? @default(false)
  information Json
  createdAt   DateTime @default(now())
}

model Devis {
  id          Int      @id @default(autoincrement())
  user_id     Int?
  product_id  Int?
  nombre      Int?
  email       String?
  entreprise  String?
  description String?  @db.Text
  telephone   String?
  productJson Json
  createdAt   DateTime @default(now())
}

enum SupportMessageSender {
  CUSTOMER
  ADMIN
}

model SupportTicket {
  ticket_id            Int              @id @default(autoincrement())
  customer_id          Int
  customer             Customer         @relation(fields: [customer_id], references: [customer_id])
  assigned_admin_id    Int?
  assigned_admin       User?            @relation("TicketAdmin", fields: [assigned_admin_id], references: [user_id])
  subject              String?
  status               String           @default("open")
  last_message_at      DateTime         @default(now())
  last_message_snippet String?          @db.Text
  created_at           DateTime         @default(now())
  updated_at           DateTime         @updatedAt
  messages             SupportMessage[]
}

model SupportMessage {
  message_id  Int                        @id @default(autoincrement())
  ticket_id   Int
  ticket      SupportTicket              @relation(fields: [ticket_id], references: [ticket_id])
  sender      SupportMessageSender
  content     String                     @db.Text
  customer_id Int?
  customer    Customer?                  @relation(fields: [customer_id], references: [customer_id])
  admin_id    Int?
  admin       User?                      @relation("MessageAdmin", fields: [admin_id], references: [user_id])
  created_at  DateTime                   @default(now())
  attachments SupportMessageAttachment[]
}

model SupportMessageAttachment {
  attachment_id Int            @id @default(autoincrement())
  message_id    Int
  message       SupportMessage @relation(fields: [message_id], references: [message_id])
  file_url      String
  file_name     String
  mime_type     String
  file_size     Int
  created_at    DateTime       @default(now())
}
